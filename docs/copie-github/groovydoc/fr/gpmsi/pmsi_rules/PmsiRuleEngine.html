<!--

     Licensed to the Apache Software Foundation (ASF) under one
     or more contributor license agreements.  See the NOTICE file
     distributed with this work for additional information
     regarding copyright ownership.  The ASF licenses this file
     to you under the Apache License, Version 2.0 (the
     "License"); you may not use this file except in compliance
     with the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing,
     software distributed under the License is distributed on an
     "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
     KIND, either express or implied.  See the License for the
     specific language governing permissions and limitations
     under the License.

-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- **************************************************************** -->
<!-- *  PLEASE KEEP COMPLICATED EXPRESSIONS OUT OF THESE TEMPLATES, * -->
<!-- *  i.e. only iterate & print data where possible. Thanks, Jez. * -->
<!-- **************************************************************** -->

<html>
<head>
    <!-- Generated by groovydoc -->
    <title>PmsiRuleEngine (gpmsi 2.1 API)</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
    <link href="../../../groovy.ico" type="image/x-icon" rel="shortcut icon">
    <link href="../../../groovy.ico" type="image/x-icon" rel="icon">
    <link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">

<body class="center">
<script type="text/javascript"><!--
if (location.href.indexOf('is-external=true') == -1) {
    parent.document.title="PmsiRuleEngine (gpmsi 2.1 API)";
}
//-->
</script>
<noscript>
    <div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
    <!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
    <!--   -->
</a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../index-all.html">Index</a></li>
        <li><a href="../../../help-doc.html">Help</a></li>
    </ul>
</div>

<div class="subNav">
    <div>
        <ul class="navList">
            <li><a href="../../../index.html?fr/gpmsi/pmsi_rules/PmsiRuleEngine" target="_top">Frames</a></li>
            <li><a href="PmsiRuleEngine.html" target="_top">No Frames</a></li>
        </ul>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            Nested&nbsp;&nbsp;&nbsp;Field&nbsp;&nbsp;&nbsp;<li><a href="#property_summary">Property</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#constructor_summary">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_summary">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
        <ul class="subNavList">
            <li>&nbsp;|&nbsp;Detail:&nbsp;</li>
            Field&nbsp;&nbsp;&nbsp;<li><a href="#prop_detail">Property</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#constructor_detail">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_detail">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
    </div>
    <a name="skip-navbar_top">
        <!--   -->
    </a></div>
<!-- ========= END OF TOP NAVBAR ========= -->

<!-- ======== START OF CLASS DATA ======== -->
<div class="header">

    <div class="subTitle">Package: <strong>fr.gpmsi.pmsi_rules</strong></div>

    <h2 title="[Groovy] Class PmsiRuleEngine" class="title">[Groovy] Class PmsiRuleEngine</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><ul class="inheritance"></ul></li><li>fr.gpmsi.pmsi_rules.PmsiRuleEngine
</ul>
<div class="description">
    <ul class="blockList">
        <li class="blockList">


            <!-- todo: direct known subclasses -->
            <hr>

<pre>class PmsiRuleEngine
extends java.lang.Object</pre>

    <p> Moteur de regles tres simpliste pour l'instant que l'on peut appeler pour évaluation de
 chaque RUM par exemple.<br>
 On initialise le moteur avec toutes les règles que l'on désire utiliser.<br>
 On appelle initialize(), ce qui initialise le moteur.<br>
 Ensuite pour chaque élément que l'on veut évaluer avec le moteur de règles, on appelle la
 méthode correspondante, par ex. <code>evalRum(rum)</code>.
 <p>

 Idees futures pour augmenter les possibilités :
 <ul>
   <li> Ajouter une API pour avoir les autres RUMs d'un même RSS, ainsi que le parcours (UMs dans l'ordre chronologique)
   <li> Ajouter une API pour avoir les autres RSS pour le même patient, avec requête sur l'ordre (suivant/précédent), et sur le temps (de l'année dernière, par ex.)
   <li> Ajouter une API pour avoir les autres RSA pour le même patient, avec requête sur l'ordre (suivant/précédent), et sur le temps (de l'année dernière, par ex.)
   <li> API pour collecter diagnostics, actes, sur un ensemble de RUM/RSS/RSA
 </ul>
 L'idée étant que l'on donne un ensemble de RSS+VIDHOSP, ou bien un ensemble de RSA+TRA+VIDHOSP, et qu'ensuite
 on parcourt les données à analyser, mais cette fois avec un contexte riche qui permet d'analyser l'antériorité
 voire quelque chose qui s'est produit plus tard (par ex. le patient recoit des
 chimios mais à aucun moment on n'a de DP de cancer).
 <p>
 A voir aussi : stockage de valeurs qui contrôlent telle ou telle évaluation
 pour enlever les faux déclenchements (ex : on n'a pas trouvé de DP de cancer
 parce que en fait le cancer a été traité à l'extérieur, on ne veut donc pas
 qu'il y ait un avertissement à chaque fois)
 <p>
 Exemple (groovy) de script utilisant un PmsiRuleEngine et des critères :
 <pre>
 //recherche de rums cancéro dans l'UF de médecine, sortis entre septembre et décembre 2024 
 package pmsi_rules
 import java.time.LocalDate
 import fr.gpmsi.DateUtils
 import fr.gpmsi.pmsi_rules.*
 import fr.gpmsi.pmsi_rules.cim.*
 import fr.gpmsi.pmsi_rules.ccam.*
 import fr.gpmsi.pmsi_rules.ghm.*
 import fr.gpmsi.pmsi_rules.rss.*
 
 ufsAutorisees = ['4001'] as Set
 
 dateSorMin = LocalDate.of(2024,  9,  1)
 dateSorMax = LocalDate.of(2024, 12, 31)
 
 critUfAutorisee = new GenericPmsiCriterion({context ->
     def rum = context['rum']
     ufsAutorisees.contains(rum.txtNUM)
 })
 
 //critère dateSorMin <= dateSor <= dateSorMax
 critDateSorOk  = new GenericPmsiCriterion({context ->
     def rum = context['rum']
     def dateSor = rum.DSUM.toLocalDate()
     dateSor != null && dateSorMin <= dateSor && dateSor <= dateSorMax
 })
 
 cimCancers = ("C00:D09").split(',') //liste des expressions de codes de cancer
 
 critCimDansSelection = new CimCodePresence("DP,DR,DAS", cimCancers) //est-ce que le code CIM du rsa est dans la selection ?
 
 //règle pour voir si cim dans la sélection et uf est autorisee et date de sortie dans la plage autorisée
 regleCimDansSelection = new PmsiCriterionRule(critCimDansSelection, critUfAutorisee, critDateSorOk)
 
 eng = new PmsiRuleEngine(regleCimDansSelection) //moteur de règles basé sur cette règle
 
 dateSorParNadl = [:]
 
 nadls = [] as Set
 
 / ** remplir dates de sortie par nadl * /
 rss {
     input args.input
     onItem {item ->
         rum = item.rum
         def dateSor = rum.DSUM.toLocalDate()
         def nadl = rum.txtNADL
         def oldDateSor = dateSorParNadl[nadl]
         if (dateSor != null && (oldDateSor == null || oldDateSor.isBefore(dateSor))) {
             dateSorParNadl[nadl] = dateSor
         }
     }
 }
 
 rss {
     input args.input
     output args.output
 
     onInit {
         outf = new FileWriter(outputFilePath)
         outf << 'NADL\r\n'
     }
 
     onItem {item->
         rum = item.rum
         int n = eng.evalRum(rum)
         def nadl = rum.txtNADL
         if (n > 0) outf << "$nadl\r\n"
     }
 
     onEnd {
         outf.close()
     }
 }

 </pre></p>

          </li>
    </ul>
</div>

<div class="summary">
    <ul class="blockList">
        <li class="blockList">
        <!-- =========== NESTED CLASS SUMMARY =========== -->
        

        <!-- =========== ENUM CONSTANT SUMMARY =========== -->
        
        <!-- =========== FIELD SUMMARY =========== -->
        

        <!-- =========== PROPERTY SUMMARY =========== -->
        
         <ul class="blockList">
                <li class="blockList"><a name="property_summary"><!--   --></a>
                    <h3>Properties Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Properties Summary table, listing nested classes, and an explanation">
                        <caption><span>Properties</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Type</th>
                            <th class="colLast" scope="col">Name and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code><strong>java.lang.Object</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#context">context</a></code><br></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code><strong>java.util.List&lt;<a href='../../../fr/gpmsi/pmsi_rules/PmsiRule.html' title='PmsiRule'>PmsiRule</a>&gt;</strong></code>&nbsp;</td>
                            <td class="colLast"><code><a href="#rules">rules</a></code><br></td>
                        </tr>
                        
                    </table>
                   </ul>
                </li>
            </ul>
        

        <!-- =========== ELEMENT SUMMARY =========== -->
        

        
        <!-- ======== CONSTRUCTOR SUMMARY ======== -->
        <ul class="blockList">
                <li class="blockList"><a name="constructor_summary"><!--   --></a>
                    <h3>Constructor Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructors Summary table">
                        <caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Constructor and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst">
                                <code><strong><a href="#PmsiRuleEngine()">PmsiRuleEngine</a></strong>()</code><br>Constructeur simple.</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst">
                                <code><strong><a href="#PmsiRuleEngine(fr.gpmsi.pmsi_rules.PmsiRule)">PmsiRuleEngine</a></strong>(<a href='../../../fr/gpmsi/pmsi_rules/PmsiRule.html'>PmsiRule</a>[] rules)</code><br>Constructeur, permet d'ajouter des règles dès la construction.
 </td>
                        </tr>
                        
                    </table>
                   </ul>
              </li>
        </ul>
        

        
        <!-- ========== METHOD SUMMARY =========== -->
        <ul class="blockList">
            
            <li class="blockList"><a name="method_summary"><!--   --></a>
                    <h3>Methods Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Methods Summary table">
                        <caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Type Params</th>
                            <th class="colLast" scope="col">Return Type</th>
                            <th class="colLast" scope="col">Name and description</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>void</code></td>
                            <td class="colLast"><code><strong><a href="#add(fr.gpmsi.pmsi_rules.PmsiRule)">add</a></strong>(<a href='../../../fr/gpmsi/pmsi_rules/PmsiRule.html'>PmsiRule</a> rule)</code><br></td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>int</code></td>
                            <td class="colLast"><code><strong><a href="#evalRsa(fr.gpmsi.pmsixml.FszGroup)">evalRsa</a></strong>(fr.gpmsi.pmsixml.FszGroup rsa)</code><br>à appeler si on évalue un RSA</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>int</code></td>
                            <td class="colLast"><code><strong><a href="#evalRum(fr.gpmsi.pmsixml.FszGroup)">evalRum</a></strong>(fr.gpmsi.pmsixml.FszGroup g)</code><br>à appeler si on evalue un RUM</td>
                        </tr>
                        
                        <tr class="rowColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>java.util.Map</code></td>
                            <td class="colLast"><code><strong><a href="#getContext()">getContext</a></strong>()</code><br>Retourner le contexte du moteur</td>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code></code></td>
                            <td class="colLast"><code>void</code></td>
                            <td class="colLast"><code><strong><a href="#initialize()">initialize</a></strong>()</code><br>initialiser toutes les règles</td>
                        </tr>
                        
                    </table>
                   </ul>
              </li>
            
            <li class="blockList"><a name="method_summary"><!--   --></a>
                    <h3>Inherited Methods Summary</h3>
                    <ul class="blockList">
                    <table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Inherited Methods Summary table">
                        <caption><span>Inherited Methods</span><span class="tabEnd">&nbsp;</span></caption>
                        <tr>
                            <th class="colFirst" scope="col">Methods inherited from class</th>
                            <th class="colLast" scope="col">Name</th>
                        </tr>
                        
                        <tr class="altColor">
                            <td class="colFirst"><code>class java.lang.Object</code></td>
                            <td class="colLast"><code>java.lang.Object#wait(long), java.lang.Object#wait(long, int), java.lang.Object#wait(), java.lang.Object#equals(java.lang.Object), java.lang.Object#toString(), java.lang.Object#hashCode(), java.lang.Object#getClass(), java.lang.Object#notify(), java.lang.Object#notifyAll()</code></td>
                        </tr>
                    </table>
                   </ul>
              </li>
                
        </ul>
        
    </li>
    </ul>
</div>

<div class="details">
    <ul class="blockList">
        <li class="blockList">
           

            

            
            <!-- =========== PROPERTY DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="prop_detail">
                    <!--   -->
                </a>
                    <h3>Property Detail</h3>
                    
                        <a name="context"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>java.lang.Object <strong>context</strong></h4>
                                <p></p>
                            </li>
                        </ul>
                    
                        <a name="rules"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>java.util.List&lt;<a href='../../../fr/gpmsi/pmsi_rules/PmsiRule.html' title='PmsiRule'>PmsiRule</a>&gt; <strong>rules</strong></h4>
                                <p></p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            

            

            
            <!-- =========== CONSTRUCTOR DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="constructor_detail">
                    <!--   -->
                </a>
                    <h3>Constructor Detail</h3>
                    
                        <a name="PmsiRuleEngine()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><strong>PmsiRuleEngine</strong>()</h4>
                                <p> Constructeur simple.</p>
                            </li>
                        </ul>
                    
                        <a name="PmsiRuleEngine(fr.gpmsi.pmsi_rules.PmsiRule)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4><strong>PmsiRuleEngine</strong>(<a href='../../../fr/gpmsi/pmsi_rules/PmsiRule.html'>PmsiRule</a>[] rules)</h4>
                                <p> Constructeur, permet d'ajouter des règles dès la construction.
 On peut ajouter plus de règles par la suite à l'aide de #add(PmsiRule) <DL><DT><B>Parameters:</B></DT><DD><code>rules</code> -  0 ou plus règles à ajouter</DD></DL></p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            


            
            <!-- =========== METHOD DETAIL =========== -->
            <ul class="blockList">
                <li class="blockList"><a name="method_detail">
                    <!--   -->
                </a>
                    <h3>Method Detail</h3>
                    
                        <a name="add(fr.gpmsi.pmsi_rules.PmsiRule)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>add</strong>(<a href='../../../fr/gpmsi/pmsi_rules/PmsiRule.html'>PmsiRule</a> rule)</h4>
                                <p></p>
                            </li>
                        </ul>
                    
                        <a name="evalRsa(fr.gpmsi.pmsixml.FszGroup)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>int <strong>evalRsa</strong>(fr.gpmsi.pmsixml.FszGroup rsa)</h4>
                                <p> à appeler si on évalue un RSA <DL><DT><B>Parameters:</B></DT><DD><code>rsa</code> -  Le RSA</DD></DL><DL><DT><B>Returns:</B></DT><DD>Le nombre de règles qui ont été évaluées a true</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="evalRum(fr.gpmsi.pmsixml.FszGroup)"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>int <strong>evalRum</strong>(fr.gpmsi.pmsixml.FszGroup g)</h4>
                                <p> à appeler si on evalue un RUM <DL><DT><B>Parameters:</B></DT><DD><code>g</code> -  Le RUM/RSS a évaluer</DD></DL><DL><DT><B>Returns:</B></DT><DD>Le nombre de règles qui ont été évaluées a true</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="getContext()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>java.util.Map <strong>getContext</strong>()</h4>
                                <p> Retourner le contexte du moteur <DL><DT><B>Returns:</B></DT><DD>Le contexte</DD></DL></p>
                            </li>
                        </ul>
                    
                        <a name="initialize()"><!-- --></a>
                        <ul class="blockListLast">
                            <li class="blockList">
                                <h4>void <strong>initialize</strong>()</h4>
                                <p> initialiser toutes les règles</p>
                            </li>
                        </ul>
                    
                </li>
            </ul>
            
        </li>
    </ul>
</div>

<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
    <!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
    <!--   -->
</a>
    <ul class="navList" title="Navigation">
        <li><a href="../../../overview-summary.html">Overview</a></li>
        <li><a href="package-summary.html">Package</a></li>
        <li class="navBarCell1Rev">Class</li>
        <li><a href="../../../deprecated-list.html">Deprecated</a></li>
        <li><a href="../../../index-all.html">Index</a></li>
        <li><a href="../../../help-doc.html">Help</a></li>
    </ul>
</div>

<div class="subNav">
    <div>
        <ul class="navList">
            <li><a href="../../../index.html?fr/gpmsi/pmsi_rules/PmsiRuleEngine" target="_top">Frames</a></li>
            <li><a href="PmsiRuleEngine.html" target="_top">No Frames</a></li>
        </ul>
    </div>
    <div>
        <ul class="subNavList">
            <li>Summary:&nbsp;</li>
            Nested&nbsp;&nbsp;&nbsp;Field&nbsp;&nbsp;&nbsp;<li><a href="#property_summary">Property</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#constructor_summary">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_summary">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
        <ul class="subNavList">
            <li>&nbsp;|&nbsp;Detail:&nbsp;</li>
            Field&nbsp;&nbsp;&nbsp;<li><a href="#prop_detail">Property</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#constructor_detail">Constructor</a></li>&nbsp;&nbsp;&nbsp;<li><a href="#method_detail">Method</a></li>&nbsp;&nbsp;&nbsp;
        </ul>
    </div>
    <p>Groovy Documentation</p>
    <a name="skip-navbar_bottom">
        <!--   -->
    </a>
    </div>
</div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
