<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>gpmsi @PROJECT_VERSION@ : documentation</title>
<style type="text/css">
.pre-dos {
    background-color: black;
    color: white;
}
</style>
</head>
<body>
<h1>Documentation gpmsi @PROJECT_VERSION@</h1>
<h2>Raccourcis</h2>
<a href="javadoc/index.html" target="_new">javadoc de gpmsi</a> -
<a href="groovydoc/index.html" target="_new">groovydoc de gpmsi</a> -
<a href="pmsixml-javadoc/index.html" target="_new">javadoc de pmsixml</a>

<h2>Introduction</h2>
<p>
Les différents traitements utilisés dans le PMSI utilisent fréquemment des
fichiers contenant des lignes de longueur fixe, avec les informations toujours
au même endroit dans chaque ligne.<br>
La construction des programmes manipulant
ces informations est très répétitive et fastidieuse.
</p>
<p>
Les fichiers <a href="https://fr.wikipedia.org/wiki/Extensible_Markup_Language">XML</a>
bien que plus complexes et moins compact ont l'avantage de la disponibilité
de nombreux outils pour leur traitement automatisé.
</p>
<p>
Lors de ma prise de fonction au sein du DIM, nous avions d'importants problèmes
de cohérence de fichiers, et le besoin de faire des scripts pouvant analyser,
comparer des fichiers de RSS, RSA, FICHCOMP, etc. était très important.
</p>
<p>
Le besoin initial était de convertir les fichiers en un format XML, qui
pouvait être plus facilement lu et transformé, d'où le nom initial du 
programme : <code>pmsixml</code>.<br>
Au fur et à mesure de la construction des scripts, des éléments communs ont
émergés et je les ai rajouté et rassemblé le tout dans une librairie.<br>
En fait l'utilisation répétée de scripts en langage Groovy a montré qu'il y
avait deux besoins :
<ul>
<li>Analyser les fichiers textes avec des champs à position fixe, de manière
rationnelle
<li>Ecrire des scripts d'automatisation pour tirer parti de diverses librairies
utiles et analyser des fichiers non seulement PMSI, mais aussi csv, Excel,
xml, de base de données, ...
</ul>
Au total la librairie pmsixml a été cantonnée aux fichiers PMSI avec champs
à position fixe (RSS, RHS, VIDHOSP, etc.),<br>
et le reste des fonctionnalités a
été mis dans une librairie que j'ai appelé gpmsi (pour <i>Groovy PMSI</i>),<br>
car elle tire tout son intérêt de l'utilisation du langage <i>Groovy</i> pour rendre
plus clairs les traitements des données PMSI (voire le traitement d'autres types
de données également).
</p>
<h2>Installation</h2>
Prérequis:
<ul>
<li>Java installé (au minimum jdk 1.8, ou bien même open-jdk8 dézippé dans un répertoire suffit)</li>
<li>La variable JAVA_HOME doit contenir le chemin vers le java à utiliser (
exemple : <code>C:\openjdk-8u322-b06</code> ou encore <code>C:\jdk1.8</code> selon ce qui est installé)</li>
<li>Des droits d'écriture suffisants dans le système de fichiers (les droits
administrateur ne sont pas nécessaires)</li>
</ul>
<p>
Installation proprement dite :
<p>
Créer un répertoire (de préférence <code>C:\app\gpmsi\v@PROJECT_VERSION@</code> pour ne pas avoir à 
modifier les scripts d'exemple), et extraire le contenu du fichier <code>gpmsi-@PROJECT_VERSION@@PROJECT_SUB_VERSION@-dist.zip</code>
dans ce répertoire.
</p>

Ouvrir une fenêtre d'explorateur de fichiers et aller dans le répertoire :
<code>C:\app\gpmsi\v2.0\scripts\bat\tutoriel</code>

<p>
Double-cliquer sur <code>bonjour.bat</code>.<br>
Si gpmsi est bien installé, une fenêtre devrait s'ouvrir et l'affichage devrait
ressembler à ceci :

<p>

<pre class="pre-dos">
C:\app\gpmsi\v2.0\scripts\bat\tutoriel>rem Le script le plus simple possible, il appelle juste bonjour.groovy

C:\app\gpmsi\v2.0\scripts\bat\tutoriel>setlocal EnableExtensions

C:\app\gpmsi\v2.0\scripts\bat\tutoriel>if not defined GPMSI_HOME set GPMSI_HOME=C:\app\gpmsi\v2.0

C:\app\gpmsi\v2.0\scripts\bat\tutoriel>set APP=C:\app\gpmsi\v2.0\gpmsi.bat

C:\app\gpmsi\v2.0\scripts\bat\tutoriel>set SCRIPT=C:\app\gpmsi\v2.0\scripts\groovy\bonjour.groovy

C:\app\gpmsi\v2.0\scripts\bat\tutoriel>call C:\app\gpmsi\v2.0\gpmsi.bat -script C:\app\gpmsi\v2.0\scripts\groovy\bonjour.groovy

Un petit bonjour à tous ? depuis le script bonjour.groovy, dans l'environnement GPMSI / Groovy.

C:\app\gpmsi\v2.0\scripts\bat\tutoriel>pause
Appuyez sur une touche pour continuer...
</pre>

<small>
(N.B. Le texte qui s'affiche est au départ :<br>
<pre>
<b>Un petit bonjour à tous ☺ depuis le script bonjour.groovy, dans l'environnement GPMSI / Groovy.</b>
</pre>
<p>
Mais à l'intérieur du terminal windows le caractère de smiley n'est pas
supporté et est remplacé par "?", cela fait partie du tutoriel pour montrer
qu'il faut bien choisir les caractères qu'on affiche via les scripts)
</small>

<h2>Lancement du menu</h2>
Il existe un script qui affiche un menu, qui permet d'ouvrir les principaux
scripts livrés avec gpmsi.<br>
Pour afficher ce menu, ouvrir une fenêtre d'explorateur de fichiers, et aller dans le répertoire :<br>
<code>C:\app\gpmsi\v2.0</code>, puis double-cliquez sur 
<code>menu.bat</code> , une fenêtre similaire à :
<p>
<img alt="resultat de menu.bat" srcset="img/gpmsi-menu.png 2x">
<p>
devrait s'ouvrir.

<h2>Utilisation des scripts</h2>
<h3>Par fenêtre</h3>
Certains scripts affichent une fenêtre qui permet d'entrer les informations
avant d'exécuter une action.<br>
Dans le menu, ce sont les entrées qui sont précédées d'un petit éclair 
<img alt="ic&ocirc;ne en forme d'&eacute;clair" src="img/zap22_o.png">
<p>
Exemple pour "RSS vers .csv" :
<p>
<img alt="fenêtre d'exécution pour conversion RSS vers .csv" srcset="img/script-fenetre-rss-csv.png 2x">
<p>
Ici la fenêtre permet de choisir les fichiers, puis de poursuivre la conversion
ou bien d'annuler. Peu de scripts font cela car il faut du développement
supplémentaire, mais c'est possible.


<h3>Par glisser-déposer</h3>
La plupart des scripts qui prennent en entrée un ou deux fichiers peuvent
fonctionner par "glisser-déposer".<br>
Par exemple dans le menu, si on clique dans
la colonne RSS sur "glisser-déposer", une fenêtre explorateur s'ouvre,<br>
et on voit des fichiers de scripts dont le nom contient "dnd" :<br>
cela correspond à "drag and drop", soit "glisser-déposer" en anglais.
<p>
<img alt="fen&ecirc;tre avec scripts de glisser-d&eacute;poser" srcset="img/rss-csv-dnd.png 1.5x">
<p>
Ici il suffit depuis une autre fenêtre de faire glisser un fichier RSS vers
le fichier <code>rss-vers-csv-dnd.bat</code><br>
puis de lâcher le bouton de la souris lorsque
le fichier RSS est au dessus du fichier "bat",<br>
cela déclenchera le script qui va traiter le fichier RSS et le transformer en fichier .csv .


<h3>Par appel du script en ligne de commande</h3>

<h2>Faire ses propres scripts avec Groovy</h2>
<p>
Gpmsi est certes livré avec un menu et quelques scripts, mais il est conçu au départ<br>
pour <i>écrire des scripts</i> en Groovy.<br>
Groovy est un langage qui étend java avec des constructions dynamiques plus
évoluées.<br>
Cela paraît abstrait dit comme cela, mais en pratique cela donne des
nouvelles possibilités dans l'écriture des programmes, dans la concision de
l'écriture et la facilité d'utilisation.<br>
Il y a de nombreuses améliorations, on pourra aller sur le site de
<a href="http://groovy-lang.org/">Groovy</a> les voir toutes.<br>
Groovy est un langage de programmation, dont les bases sont plus
simples à acquérir que pour le langage R.<br>
Mais <b>l'apprentissage n'est pas trivial malgré tout</b>, surtout si on n'a
jamais utilisé le langage java.<br>
Il y a de nombreuses ressources pour apprendre java, par ex. sur
<a href="https://java.developpez.com/cours/">Developpez.com</a>,
et pour apprendre groovy, on trouve également des ressources en français sur
<a href="https://ericreboisson.developpez.com/tutoriel/java/groovy/">Developpez.com</a>.

<p>
Il y a maintenant un manuel séparé pour aborder la programmation des scripts.
<p>
Voici entre autres ce que vous permet l'utilisation des scripts groovy dans
gpmsi :

<ul>
<li>Filtrage de fichiers PMSI (RSS,RHS,RSA,VIDHOSP,etc.)</li>
<li>Génération/correction de fichiers PMSI à partir d'un autre format</li>
<li>Traitement de fichiers .csv</li>
<li>Traitement de fichiers Excel (.xls et .xlsx)</li>
<li>Envoi de données PMSI dans la base de données H2 de gpmsi</li>
<li>Envoi de données PMSI dans une base de données (SQL) extérieure</li>
<li>Programmation de menus</li>
<li>Programmation de petites applications en mode fenêtré</li>
<li>Règles de détection de séjours sur critères variés</li>
<li>Préparation de fichiers pour utilisation avec R (pour utilisation de R
avec pmsi de manière systématique, voir plutôt
<a href="https://guillaumepressiat.github.io/pmeasyr-book/">https://guillaumepressiat.github.io/pmeasyr-book/</a>
et 
<a href="https://denisgustin.github.io/refpmsi/index.html">https://denisgustin.github.io/refpmsi/index.html</a>
)</li>
</ul>

<h3>License</h3>
Gpmsi (et pmsixml) sont sous <a href="https://www.apache.org/licenses/LICENSE-2.0.txt">license Apache 2.0</a>.
<p>
Vous trouverez ci-joint <a href="LICENSE-2.0.txt">une copie de cette license</a>,<br>
ainsi que le fichier <a href="NOTICE">NOTICE</a> qui l'accompagne.
<p>
<hr>

</body>
</html>